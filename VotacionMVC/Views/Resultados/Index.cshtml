@model VotacionMVC.Models.ViewModels.ResultadosVm
@{
    ViewData["Title"] = "Resultados";
    var vivoActive = (Model?.Modo ?? "vivo") == "vivo";
    var finActive = (Model?.Modo ?? "vivo") == "final";
}

<div class="container py-4">

    <h2 class="text-center mb-1">📊 Resultados Electorales en Tiempo Real</h2>
    <div class="text-center text-muted mb-3">Elecciones Presidenciales 2026</div>

    <!-- BOTONES QUE SÍ FUNCIONAN -->
    <div class="d-flex justify-content-center gap-2 mb-4">
        <a class="btn @(vivoActive ? "btn-primary" : "btn-outline-primary")"
           asp-controller="Resultados" asp-action="Index"
           asp-route-modo="vivo" asp-route-provincia="@Model.ProvinciaSeleccionada">
            En vivo
        </a>

        <a class="btn @(finActive ? "btn-primary" : "btn-outline-primary")"
           asp-controller="Resultados" asp-action="Index"
           asp-route-modo="final" asp-route-provincia="@Model.ProvinciaSeleccionada">
            Finales
        </a>
    </div>

    <!-- Estado + última actualización -->
    <div class="card mb-3">
        <div class="card-body d-flex justify-content-between flex-wrap gap-2">
            <div>
                <div class="text-muted">Estado del proceso</div>
                <div class="fw-bold">@Model.EstadoProceso</div>
            </div>
            <div class="text-end">
                <div class="text-muted">Última actualización</div>
                <div class="fw-bold">@Model.UltimaActualizacion</div>
            </div>
        </div>
    </div>

    <!-- Líder grande -->
    <div class="card mb-4" style="background:#2fb167; color:white; border:0;">
        <div class="card-body text-center py-5">
            <div class="opacity-75">🏆 CANDIDATO LIDERANDO</div>
            <div class="display-6 fw-bold">@Model.LiderNombre</div>
            <div class="mt-2">@Model.LiderAmbito</div>
            <div class="h2 mt-2 fw-bold">@Model.LiderVotos.ToString("N0") votos</div>

        </div>
    </div>

    <!-- Filtro provincia (simple: recarga por GET) -->
    <div class="card mb-3">
        <div class="card-body">
            <div class="fw-bold mb-2">Filtrar por provincia</div>

            <form method="get" asp-controller="Resultados" asp-action="Index">
                <input type="hidden" name="modo" value="@Model.Modo" />

                <select class="form-select" name="provincia" onchange="this.form.submit()">
                    <option value="Nacional" selected="@(Model.ProvinciaSeleccionada == "Nacional")">Todas (Nacional)</option>

                    @foreach (var p in Model.LideresPorProvincia.Select(x => x.Provincia).Distinct())
                    {
                        <option value="@p" selected="@(Model.ProvinciaSeleccionada.Equals(p, StringComparison.OrdinalIgnoreCase))">@p</option>
                    }
                </select>

                <div class="text-muted mt-2">
                    *El filtro cambia el líder mostrado.
                </div>
            </form>
        </div>
    </div>

    <!-- Tabla líderes por provincia -->
    @if (Model.LideresPorProvincia.Count > 0)
    {
        <div class="card">
            <div class="card-body">
                <div class="fw-bold mb-2">🗺️ Líder por provincia</div>

                <div class="table-responsive">
                    <table class="table table-sm align-middle">
                        <thead>
                            <tr>
                                <th>Provincia</th>
                                <th>Líder</th>
                                <th class="text-end">Votos</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var row in Model.LideresPorProvincia)
                            {
                                <tr>
                                    <td>@row.Provincia</td>
                                    <td class="fw-bold">@row.Lider</td>
                                    <td class="text-end">@row.Votos.ToString("N0")</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>

            </div>
        </div>
    }
</div>
