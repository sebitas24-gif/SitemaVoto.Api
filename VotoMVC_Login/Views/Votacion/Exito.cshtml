@{
    ViewData["Title"] = "Voto Registrado";
    var email = (TempData.Peek("Email") as string) ?? "";
    var comp = (TempData.Peek("Comprobante") as string) ?? "";

    var nombre = (TempData.Peek("Nombre") as string) ?? "";
    var cedula = (TempData.Peek("Cedula") as string) ?? "";
    var provincia = (TempData.Peek("Provincia") as string) ?? "";
    var canton = (TempData.Peek("Canton") as string) ?? "";
    var mesa = (TempData.Peek("Mesa") as string) ?? "";
    var fotoUrl = (TempData.Peek("FotoUrl") as string) ?? "";
}

@section Styles {
    <link rel="stylesheet" href="~/css/comprobante.css" asp-append-version="true" />
}

<div class="cmp-page">
    <div class="cmp-wrap">

        <!-- Banner éxito -->
        <div class="cmp-success">
            <div class="cmp-success-icon">✓</div>
            <div>
                <div class="cmp-success-title">Voto registrado exitosamente</div>
                <div class="cmp-success-sub">Su voto fue procesado de forma segura y anónima.</div>
            </div>
        </div>

        @if (!string.IsNullOrWhiteSpace(email))
        {
            <div class="cmp-info">
                Se envió una copia del comprobante al correo: <b>@email</b>
            </div>
        }

        <!-- Tarjeta / certificado -->
        <div class="cmp-card">

            <div class="cmp-header">
                <div class="cmp-brand">
                    <div class="cmp-seal">
                        <!-- “Sello” fake bonito -->
                        <div class="cmp-seal-inner">CNE</div>
                    </div>
                    <div>
                        <div class="cmp-country">REPÚBLICA DEL ECUADOR</div>
                        <div class="cmp-entity">CONSEJO NACIONAL ELECTORAL</div>
                        <div class="cmp-doc">Certificado de Sufragio</div>
                    </div>
                </div>

                <div class="cmp-meta">
                    <div class="cmp-meta-box">
                        <div class="lbl">Código de verificación</div>
                        <div class="val">@(!string.IsNullOrWhiteSpace(comp) ? comp : "—")</div>
                    </div>

                    <div class="cmp-meta-box">
                        <div class="lbl">Fecha y hora</div>
                        <div class="val">@DateTime.Now.ToString("dd/MM/yyyy HH:mm:ss")</div>
                    </div>
                </div>
            </div>

            <div class="cmp-body">

                <!-- Columna izquierda: datos mínimos -->
                <div class="cmp-left">

                    <div class="cmp-section-title">Datos del elector </div>

                    <div class="cmp-grid">
                        <div class="cmp-field">
                            <div class="k">Nombre</div>
                            <div class="v">@(!string.IsNullOrWhiteSpace(nombre) ? nombre : "—")</div>
                        </div>

                        <div class="cmp-field">
                            <div class="k">Cédula</div>
                            <div class="v">@(!string.IsNullOrWhiteSpace(cedula) ? cedula : "—")</div>
                        </div>

                        <div class="cmp-field">
                            <div class="k">Provincia</div>
                            <div class="v">@(!string.IsNullOrWhiteSpace(provincia) ? provincia : "—")</div>
                        </div>

                        <div class="cmp-field">
                            <div class="k">Cantón</div>
                            <div class="v">@(!string.IsNullOrWhiteSpace(canton) ? canton : "—")</div>
                        </div>

                        <div class="cmp-field" style="grid-column:1/-1;">
                            <div class="k">Mesa</div>
                            <div class="v">@(!string.IsNullOrWhiteSpace(mesa) ? mesa : "—")</div>
                        </div>
                    </div>

                    <div class="cmp-note">
                        <b>Nota:</b> Este comprobante certifica que usted votó. No incluye su selección.
                    </div>

                    <div class="cmp-privacy">
                        Privacidad: el sistema no almacena su elección en este documento.
                    </div>
                </div>

                <!-- Columna derecha: foto (si hay) + QR fake -->
                <div class="cmp-right">

                    @* FOTO OPCIONAL *@
                    @if (!string.IsNullOrWhiteSpace(fotoUrl))
                    {
                        <div class="cmp-photo">
                            <img src="@fotoUrl"
                                 alt="Foto del elector"
                                 onerror="this.closest('.cmp-photo').style.display='none';" />
                            <div class="cmp-photo-cap">Foto (opcional)</div>
                        </div>
                    }
                    else
                    {
                        <div class="cmp-photo" style="display:flex;align-items:center;justify-content:center;flex-direction:column;
                                                     width:160px;height:200px;border:1px dashed #cfcfe6;border-radius:16px;
                                                     background:#f7f7ff;color:#6c757d;">
                            <div style="font-size:42px;line-height:1;">👤</div>
                            <div style="margin-top:8px;font-weight:700;">Sin foto</div>
                            <div style="font-size:12px;opacity:.85;">(No registrada)</div>
                        </div>
                    }

                    <div class="cmp-qr">
                        <div class="cmp-qr-text">
                        </div>
                    </div>

                </div>

            </div>

            <div class="cmp-footer">
                <div class="cmp-footer-left">
                    Documento generado automáticamente. Válido solo como comprobante informativo.
                </div>
             
            </div>

        </div>

        <div class="cmp-actions">
            <a class="btn btn-primary btn-lg" asp-controller="Votacion" asp-action="Index">Volver</a>
            <a class="btn btn-outline-secondary btn-lg"
               asp-controller="Votacion"
               asp-action="DescargarComprobantePdf">
                Descargar comprobante (PDF)
            </a>
        </div>

    </div>
</div>

